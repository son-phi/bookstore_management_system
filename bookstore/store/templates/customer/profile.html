{% extends "base.html" %}
{% block title %}Profile{% endblock %}
{% block content %}
<h3>Profile</h3>

<div class="card mb-3">
  <div class="card-body">
    <div><b>Username:</b> {{ user.username }}</div>
    <div><b>Email:</b> {{ user.email }}</div>
    <div><b>Phone:</b> {{ user.phone }}</div>

    <form method="post" action="/profile/update/" class="mt-3">
      {% csrf_token %}
      <div class="row g-2">
        <div class="col"><input class="form-control" name="email" value="{{ user.email }}" placeholder="Email"></div>
        <div class="col"><input class="form-control" name="phone" value="{{ user.phone }}" placeholder="Phone"></div>
      </div>
      <button class="btn btn-primary mt-2">Update</button>
    </form>
  </div>
</div>

{% if staff_profile %}
<div class="card mb-4 border-danger">
  <div class="card-header bg-danger-subtle fw-bold text-danger-emphasis">
    Staff Management ({{ staff_profile.employeeCode }})
  </div>
  <div class="card-body">
    <div class="list-group list-group-flush">
      <a href="/staff/warehouses/" class="list-group-item list-group-item-action">Manage Warehouses</a>
      <a href="/staff/suppliers/" class="list-group-item list-group-item-action">Manage Suppliers</a>
      <a href="/staff/slips/" class="list-group-item list-group-item-action">Manage Import Slips</a>
    </div>
  </div>
</div>
{% endif %}

<div class="mb-4">
  <h5 class="mb-2">Order History</h5>
  <table class="table table-striped bg-white border">
    <thead>
      <tr><th>#ID</th><th>Date</th><th>Total</th><th>Status</th><th>Action</th></tr>
    </thead>
    <tbody>
      {% for o in orders %}
      <tr>
        <td>#{{ o.orderID }}</td>
        <td>{{ o.orderDate|date:"Y-m-d H:i" }}</td>
        <td>{{ o.totalAmount }}</td>
        <td>
          {% with h=o.orderhistory_set.last %}
            {% if h %}
              <span class="badge bg-secondary">{{ h.statusID.name }}</span>
            {% else %}
              <span class="badge bg-light text-dark border">Pending</span>
            {% endif %}
          {% endwith %}
        </td>
        <td><a class="btn btn-sm btn-outline-primary" href="/orders/{{ o.orderID }}/">View</a></td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-center text-muted">No orders found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="d-flex justify-content-between align-items-center">
  <h5 class="m-0">Addresses</h5>
  <a class="btn btn-sm btn-outline-dark" href="/profile/address/add/">Add address</a>
</div>

<ul class="list-group mt-2">
  {% for a in addresses %}
    <li class="list-group-item">
      {{ a.street }}, {{ a.districtID.name }}, {{ a.districtID.cityID.name }} {% if a.isDefault %}<span class="badge bg-success">Default</span>{% endif %}
    </li>
  {% empty %}
    <li class="list-group-item text-muted">No addresses</li>
  {% endfor %}
</ul>
{% endblock %}
